# Background: Windows Memory Layout

* **메모리 레이아웃**(Memory Layout): 프로세스 가상 메모리(Virtual Memory)의 구성
    - 프로그램을 실행하면 운영체제는 프로세스에게 **사용 가능한 메모리 공간**을 할당해 줌 → 이 메모리 공간을 **가상 메모리**라고 부름
    - 운영체제는 프로그램의 정보를 참조하여 프로그램에 저장된 데이터가 적절한 영역에 저장되게 함
        + 프로세스가 사용할 가상 메모리를 용도 별로 구획함 → 프로세스가 사용하는 데이터를 적절한 구획에 저장함
        + 유사한 데이터를 모아놓는 방식의 이점
            | | 설명 |
            |:---:|------|
            | 운영 체제 | 각 구획에 적절한 권한을 부여할 수 있음 |
            | 개발자 | 프로세스의 메모리를 더 직관적으로 이해할 수 있음 |
* ❗️ 리버스 엔지니어링의 핵심 = *바이너리를 분석하여 바이너리의 동작을 이해하는 것*
    - 바이너리의 동작은 메모리와 굉장히 밀접한 관련이 있음 <br/> &nbsp;&nbsp; → 바이너리의 동작을 자세히 이해하기 위해서는 바이너리가 상호작용하는 메모리에 대한 이해가 필요함

<br/><br/>

## 섹션(section)
유사한 용도로 사용되는 데이터가 모여있는 영역
* 📌 윈도우의 PE 파일은 **PE 헤더와 1개 이상의 섹션으로 구성**되어 있음
    - 섹션에 대한 정보 → PE 헤더에 적혀있음
        | PE 헤더에 저장되는 섹션과 관련된 데이터 중 중요한 것 |
        |---|
        | 섹션의 이름 |
        | 섹션의 크기 |
        | 섹션이 로드될 주소의 오프셋 |
        | 섹션의 속성과 권한 |
        + 윈도우는 PE를 실행할 때 이 정보를 참고하여 PE의 각 섹션들을 가상 메모리의 적절한 세그먼트에 매핑함
* PE에 필수로 존재해야 하는 섹션이 정해진 것은 아니지만, **".text", ".data", ".rdata" 섹션이 일반적으로 사용됨**

<br/>

### .text 섹션
| | 설명 |
|:---:|------|
| 정의 및 설명 | 실행 가능한 코드가 위치하는 영역 |
| 일반적인 권한 | **읽기/실행 권한** → 프로그램이 동작하려면 코드를 실행할 수 있어야 하기 때문 <br/> &nbsp; ⚠️ 쓰기 권한이 존재하면 공격자가 악의적인 코드를 삽입하기 쉬워지므로, **쓰기 권한은 제거됨** |
| 사용 예시 | <img width="850" alt="텍스트 섹션" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/fe2d0dd1-b598-4de4-a6b8-7eb529c7f83a"> |

<br/>

### .data 섹션
| | 설명 |
|:---:|------|
| 정의 및 설명 | 컴파일 시점에 값이 정해진 전역 변수(초기화된 전역 변수)들이 위치하는 영역 |
| 일반적인 권한 | **읽기/쓰기 권한** |
| 사용 예시 | <img width="850" alt="데이터 섹션" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/a39657a3-7f83-4c8b-8fc7-a191825e3d2d"> |

<br/>

### .rdata 섹션
| | 설명 |
|:---:|------|
| 정의 및 설명 | 컴파일 시점에 값이 정해진 전역 상수(초기화된 전역 상수)와 DDL 및 외부 함수들의 정보(임포트 데이터)가 위치하는 영역 <br/> &nbsp;&nbsp; - 과거에는 참조할 DLL과 외부 함수들의 정보(임포트 데이터)를 .idata 섹션에 저장했지만, 최근에는 대부분 .rdata에 저장함 |
| 일반적인 권한 | **읽기 전용** |
| 사용 예시 | <img width="850" alt="rdata 섹션" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/07b30fdc-f83e-4221-95b7-50086b4523da"> |

<br/><br/>

## 스택(stack)

<br/><br/><br/><br/>
### 🔖 출처
* [드림핵 Reverse Engineering] 📌 [Background: Windows Memory Layout](https://dreamhack.io/lecture/courses/209)

# File Vulnerability cases
 📌 파일과 관련된 취약점이 발생했을 때 읽거나 쓸 파일들 → [File Vulnerabilities for Windows](https://github.com/augustf86/Today_I_Learn/blob/main/Security/Web%20Hacking/File%20Vulnerabilities%20for%20Windows.md), [File Vulnerabilities for Linux](https://github.com/augustf86/Today_I_Learn/blob/main/Security/Web%20Hacking/File%20Vulnerabilities%20for%20Linux.md) 참고 <br/>
 📌 **파일 취약점**: 파일 업로드 및 다운로드가 가능하다면 웹 셸을 통해 서버를 장악하거나 정보를 수집하는 등의 행위를 할 수 있음

<br/>

* 운영 체제를 비롯해 거의 모든 응용 프로그램은 파일에 의존해 실행됨
    - 일부 기능은 파일에 따라서 실행되는 코드가 달라짐 → 다양한 방법으로 악의적인 행위를 할 수 없도록 함
    - 파일과 관련된 취약점을 모두 막기 위해 필요한 요구사항
        + [기본] 응용 프로그램의 기능을 모두 이해하는 것
            - 소프트웨어에 대한 이해 부족으로 잘못된 방식으로 검사할 경우 의도한 기능조차 수행되지 않는 가용성 문제가 발생하거나 검사가 우회될 수 있음
        + 운영 체제에 대한 이해

<br/><br/>

## 우회 공격
* 널 문자
    - C 언어의 널(NULL): 문자열의 끝을 나타내거나 값을 초기화하는 용도로 사용되는 문자
        + 대부분의 웹 프로그래밍 언어에서도 널 문자를 사용할 수 있음
        + URL의 파라미터에 ```%00```을 삽입해 데이터를 전송할 수 있음
    - 운영 체제에서 파일명에 널 문자가 포함될 경우 널 문자가 위치한 곳을 파일명의 끝으로 인식함
        + 파일명에 널 문자가 포함되었을 때 운영 체제의 해석
            | URL 인코딩 입력 | C 문자열 표기 | 실제 인식된 파일 |
            |---|---|---|
            | ```foo/bar.jpg``` | ```"foo/bar.jpg"``` | ```foo/bar.jpg``` |
            | ```hello%00world``` | ```"hello\0world"``` | ```hello``` |
            | ```baz/qux.cfg%00.jpg``` | ```"baz/qux.cfg\0.jpg"``` | ```baz/qux.cgf``` |
        + 웹 응용 프로그램에서 널 문자를 허용하고 파일명의 끝에 있는 문자열로 확장자를 판단하면 공격자는 실제 확장자 뒤에 널 문자를 삽입해 확장자 검사를 우회하고 악의적인 행위가 가능함
        + 널 문자 검사
            | 종류 | 설명 |
            |---|------|
            | 아파치 등의 유명 웹 서버 | 널 문자가 포함된 요청이 들어올 경우 ```400 Bad Request``` 응답을 반환하고 기능을 수행하지 않음 |
            | 파이썬, PHP 등 다양한 언어에서 <br/>제공하는 라이브러리 | 파일명에 널 문자가 포함되어 있는지 확인함 |
            | 외부 라이브러리 | 널 문자가 포함되어 있는지 검사가 이뤄지지 않는 경우가 있음 <br/> &nbsp;&nbsp; → **파일을 입력받을 경우 입력값에 널 문자 또는 불필요한 특수 문자가 포함되어 있는지 검사하는 것을 권장함** |

<br/>

* Path Traversal: 업로드 및 다운로드 경로를 조작하는 공격 방식
    - 이용자가 업로드하거나 다운로드 할 파일을 지정할 수 있을 때 사용할 수 있음
    - 윈도우와 유닉스 계열의 운영 체제에서 존재하는 특수한 의미를 가진 디렉토리
        | 디렉터리 명칭 | 의미 | 예시 |
        |---|----|----|
        | ```.``` | 현재 디렉터리 | ```foo/. (= foo)``` <br/> ```foo/bar/././baz (= foo/bar/baz)``` |
        | ```..``` | 상위 디렉터리 | ```bar/baz/.. (= bar)``` <br/> ```alpha/../beta (=beta)``` <br/> ```foo/.. (= .)``` <br/> ```foo/bar/baz/qux/../../quux (= foo/bar/quux)``` <br/> ```/home/../../../../../ (= /)``` |
        + 웹 응용프로그램에서 ```.```, ```..``` 디렉터리를 검사하지 않으면 공격자는 상위 경로에 존재하는 파일에 접근해 악의적인 행위가 가능함
        +  Windows OS와 Linux OS의 차이점
            | 운영 체제 | 설명 |
            |---|------|
            | 윈도우 | ```foo\bar\..\baz```를 입력했을 때 ```bar``` 디렉터리가 존재하지 않아도 ```foo\baz``` 디렉터리에 접근할 수 있음 |
            | 리눅스 | 존재하지 않는 디렉터리가 포함될 경우 에러를 출력함 |
            - 서로 다른 운영 체제에서 같은 코드로 작성된 프로그램 배포 시 이러한 점을 인지하고 시큐어 코딩을 적용해야 함

<br/>

* 정규식 확장자 검사

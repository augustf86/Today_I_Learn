# Web Hacking: Server-side Advanced - File Vulnerability
🔖 출처
* [Dreamhack Lecture] Server-side Advanced - File Vulnerability [🔗](https://dreamhack.io/lecture/courses/33)

<br/><br/>

## Overview: File Vulnerability
📌 File Vulnerability Basic [🔗](https://github.com/augustf86/Today_I_Learn/blob/main/Security/Web%20Hacking/Web%20Hacking:%20Server-side%20Basic.md#file-vulnerability) *← click!*
* File Vulnerability 분류
    | 분류 | 설명 |
    |:---:|------|
    | ***File Upload Vulnerability*** <br/> (파일 업로드 취약점) | 서버의 파일 시스팀에 사용자가 원하는 경로 또는 파일명 등으로 업로드가 가능하여 악영향을 미칠 수<br/> 있는 파일이 업로드되는 취약점 <br/> &nbsp;&nbsp; - 주로 **웹 서비스 관련 파일이 위치한 디렉터리**에 WebShell 등 스크립트를 업로드하여 원하는<br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 코드를 실행하는 데 이용됨 <br/> &nbsp;&nbsp; - 이 외에도 다른 시스템 파일이나 유저 파일을 **변조**하는 데 이용할 수도 있음 |
    | ***File Download Vulnerability*** <br/> (파일 다운로드 취약점) | 서버의 기능 구현 상 의도하지 않은 파일을 다운로드할 수 있는 취약점 <br/> &nbsp;&nbsp; - 주로 웹 서비스의 고객 데이터나 암호화 키 등 **기밀 정보를 유출**하는 데 이용됨 <br/> &nbsp;&nbsp; - 적절한 접근 권한이 있는 경우 시스템의 중요한 정보를 획득하는 것도 가능함 |

<br/><br/><br/>

## 리눅스 파일 시스템
* 웹 서버의 70% 이상에서 사용되는 Unix 계열의 운영체제의 특징
    - *"Everything is a file."* = 장치, 프로세스 등 상당수의 객체들을 파일시스템을 통해 제어할 수 있음 <br/> &nbsp;&nbsp; ***→ ⚠️ 파일 업로드/다운로드 취약점이 발생할 경우 큰 영향을 미칠 수 있음***
    - 디스크 저장 유무로 분류하는 파일의 종류
        + 대부분의 파일들은 디스크 상에 위치하여 문서 등을 저장하는 보관소 역할을 함
        + 실제 저장되지 않고 대신 가상 파일시스템에 위치하여 운영체제의 각종 기능을 제공하는 **가상 파일**도 존재함
<br/>

* 리눅스 파일시스템에 존재하는 디렉터리와 파일들
    - **로그 및 데이터 파일**: 운영체제 및 서비스의 로그와 각종 문서가 저장되는 위치
        | 디랙터리 | 설명 |
        |:---:|------|
        | /var/www | 웹 문서 및 기타 웹 서버에서 사용되는 파일을 저장함 |
        | /var/lib | 시스템의 각종 서비스에서 자료를 저장할 때 사용함 → 데이터베이스 등이 이에 속함 <br/> &nbsp;&nbsp; - ***/var/lib/mysql*** : MySQL 데이터베이스의 데이터가 저장되는 디렉터리 <br/> &nbsp;&nbsp; - ***/var/lib/pgsql*** 또는 ***/var/lib/postgresql*** : PostgreSQL 데이터베이스의 데이터가 저장되는 디렉터리 |
        | /var/log | 시스템 서비스 등의 로그를 저장할 때 사용함 → 웹 서비스의 로그가 보통 여기에 위치함 |
        | /var/cache | 캐시 데이터를 저장함 → 일반적으로 삭제되어도 재생성이 가능함 |
        | /media | 제거 가능한 매체(USB 플래시 메모리, 기타 이동 저장장치 등)을 마운트할 때 주로 사용함 |
        | /mnt | 기타 파일 시스템을 임시로 마운트하는 용도로 주로 사용함 |
    - **설정 파일**: 운영체제 및 서비스를 구성하는 설정 파일
        | 디렉터리 | 설명 |
        |:---:|------|
        | /etc | 운영체제 초기 부팅 시 필요한 최소한의 명령어를 구현하는 프로그램 파일을 저장함 <br/> &nbsp;&nbsp; - ***/etc/apache2*** 또는 ***/etc/httpd*** : Apache Web Server의 설정 정보를 저장하는 디렉터리 <br/> &nbsp;&nbsp; - ***/etc/nginx*** : Nginx 웹 서버의 설정 정보를 저장하는 디렉터리 <br/> &nbsp;&nbsp; - ***/etc/mysql*** : MySQL 데이터베이스 서버의 설정 정보를 저장하는 디렉터리 |
        | /opt/etc | 추가적으로 설치된 프로그램의 설정 정보를 저장함 (존재하지 않을 수도 있음) |

        | 파일 | 설명 |
        |:---:|------|
        | /etc/mysql/my.cnf | MySQL 데이터베이스 서버의 주 설정파일(.cnf) |
        | /etc/passwd, /etc/group | 사용자 및 그룹 정보를 저장함 |
        | /etc/shadow, /etc/gshadow | 사용자 및 그룹의 인증 비밀번호를 암호화하여 저장함 (Shadow Password 정책 사용) <br/> &nbsp;&nbsp; ***→ 일반적으로 관리자 및 권한 있는 프로그램만이 접근할 수 있음*** |
        | /etc/hostname | 현재 시스템의 호스트네임을 저장함 |
        | /etc/hosts | 호스트네임의 실주소를 탐색할 때 사용되는 정적 순람표 |
        | /etc/fstab | 현재 시스템에 등록할 파일시스템의 목록을 저장함 |
    - **프로그램 및 라이브러리**: 프로그램의 명령어가 저장된 위치와 이들을 실행하기 위한 라이브러리의 위치
        | 디렉터리 | 설명 |
        |:---:|------|
        | /bin, /sbin | 운영체제 초기 부팅 시 필요한 최소한의 명령어를 구현하는 프로그램 파일을 저장함 |
        | /boot | 커널이나 부트로더 옵션 등 부팅에 필요한 파일을 저장함 |
        | /lib, /lib64, /libx32, ... | 운영체제 초기 부팅 시 필요한 최소한의 라이브러리 파일을 저장함 |
        | /opt | 추가적인 프로그램을 저장함 |
        | /usr/bin | 각종 명령어 및 프로그램 파일을 저장함 |
        | /usr/sbin | 시스템 관리자가 주로 사용하는 각종 명령어 및 프로그램 파일을 저장함 |
        | /usr/lib, /usr/lib64, /usr/libx32, ... | 시스템에서 공유되는 라이브러리 파일을 저장함 |
        | /usr/share | 기타 파일 시스템에서 공유되는 파일을 저장함 |
    - **장치 및 가상 파일**: 운영체제를 구성하기 위한 파일 (각각의 파일은 커널 기능과 밀접한 연관이 있음)
        | 디렉터리 | 설명 |
        |:---:|------|
        | /dev | 각종 디스크 및 장치 파일을 제공함 |
        | /sys | 하드웨어(주변기기 등) 및 플랫폼에 접근할 수 있도록 함 |
        | /proc | 프로스세 및 시스템 정보를 제공하는 가상 파일 시스템이 위치함 <br/> &nbsp;&nbsp; - ***/proc/sys*** : 운영체제의 동작을 제어할 수 있는 각종 파라미터가 위치하는 디렉터리 <br/> &nbsp;&nbsp; - ***/proc/self/net*** (또는 ***/proc/net***) : 운영체제 네트워크 계층의 다양한 정보를 제공함 |

        | 파일 | 설명 |
        |:---:|------|
        | /dev/null, /dev/zero, /dev/full, <br/> /dev/random, /dev/unrandom | 실제 물리적인 장치를 나타내지는 않지만 자주 사용되는 특수 파일 |
        | /dev/pts | 유사터미널(pseudoterminal) TTY 장치가 위치한 디렉터리 → SSH 터미널 또는 터미널 에물레이터 등에서 <br/>사용됨 |
        | /dev/stdin → /proc/self/fd/0 | 파일 디스크럽터 0, 즉 표준 입력(standard input)에 사용된 파일을 나타내는 심볼릭 링크 |
        | /dev/stdout → /proc/self/fd/1 | 파일 디스크럽터 1, 즉 표준 출력(standard output)에 사용된 파일을 나타내는 심볼릭 링크 |
        | /dev/stderr → /proc/self/fd/2 | 파일 디스크럽터 2, 즉 표준 오류 출력(standard error)에 사용된 파일을 나타내는 심볼릭 링크 |
    - **임시 파일**: 운영 체제 및 서비스에서 사용하는 임시 디렉터리 또는 파일
        | 디렉터리 | 설명 |
        |:---:|------|
        | /tmp | 임시 파일을 저장함 <br/> &nbsp;&nbsp; - 시스템 재시작(재부팅) 시 저장된 파일이 삭제될 수 있으며, 용량에 상당한 제한이 있을 수 있음 <br/> &nbsp;&nbsp; - 디스크 또는 메모리 상(tmpfs, [🔗](https://www.kernel.org/doc/html/latest/filesystems/tmpfs.html))에 존재할 수 있음 |
        | /var/tmp | 임시 파일을 저장함 → 시스템 재시작(재부팅) 시에도 일반적으로 유지됨 |
        | /run (/var/run) | 부팅 후 생성된 각종 런타임 데이터 및 IPC 소켓 등이 이곳에 위치함 → 일반적으로 디스크에 저장되지 않고 메모리 상에서만 존재함(tmpfs) <br/> &nbsp;&nbsp; - ***/var/run/postgresql*** : PostgreSQL 소켓 등이 위치하는 디렉터리 <br/> &nbsp;&nbsp; - ***/var/run/mysql*** : MySQL 소켓 등이 위치하는 디렉터리 |
        | /dev/shm | Linux ```shm_open(3)``` C 라이브러리 함수(shared memory 생성/열기 기능을 수행함)에서 사용됨 <br/> &nbsp;&nbsp; - 일반적으로 디스크에 저장되지 않고 메모리 상에서만 존재함(tmpfs) <br/> &nbsp;&nbsp; - 시스템에 따라 존재하지 않을 수도 있음 |


### 파일 업로드 시 공격 지점

<br/><br/><br/>

## 윈도우 파일 시스템

### 파일 업로드 시 공격 지점

<br/><br/><br/>

## 파일명 검증 부재

<br/><br/><br/>

## 응용

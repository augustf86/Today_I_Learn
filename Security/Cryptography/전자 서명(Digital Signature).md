# 전자 서명(Digital Signature)

* 행위자가 자신의 신원을 표기하려고 사용하는 서명의 특징을 암호학적으로 구현한 것
    - **메시지가 서명자에게서 왔음을 증명하고, 문서 작성으로 인해 발생하는 모든 문제에 대한 책임은 서명자에 있음을 명시**하는 서명의 특징을 구현함
* 📌 전자 서명은 **공개키 암호**가 만들어지며 같이 만들어짐
    | | 설명 |
    |:---:|------|
    | 역사 | - 1976년 Diffie와 Hellman이 전자 서명의 개념을 소개함 <br/> - 1978년 RSA 암호 알고리즘이 만들어지면서 전자 서명이 사용되기 시작함 |
    | 전자 서명 알고리즘 | 📌 **공개키 알고리즘의 개인키로 서명을 생성하고, 공개키로 그 서명에 대한 검증을 진행함** <br/> &nbsp;&nbsp; - **서명키**(Signing Key): 서명을 생성하는 개인키 <br/> &nbsp;&nbsp; - **검증키**(Vertification Key): 검증에 사용되는 공개키 |
    | 목적 | 메시지의 무결성과 부인 방지를 위해 사용됨 |
* 전자 서명을 사용하는 사례
    - 공동인증서 (구 공인 인증서)
        + 공동인증서에는 발급 대상의 신원 정보와 함께 공인 인증 기관(Certificate Authority)이 작성한 전자 서명이 포함되어 있음
        + 공동인증서의 인증 과정
            | 순서 | 설명 |
            |:---:|------|
            | 01 | 사용자가 인증을 요구하는 서비스에 공동인증서를 제출함 |
            | 02 | 서버(서비스)는 인증서의 서명을 검증하여 인증서에 적힌 개인의 신원을 신뢰함 <br/> &nbsp;&nbsp; - 해당 신원은 공인 인증 기관이 보증하는 것 <br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; → 보안에 민감한 금융/전자 정부 서비스는 공동인증서를 이용하여 개인을 식별했음 |
    - HTTPS 프로토콜의 웹 서버 검증
        + HTTPS 프로토콜을 사용하는 웹 서버가 인증서를 게재하게 하여 사용자가 웹 서버를 검증할 수 있게 하도록 하고 있음
        + 몇몇 브라우저들은 여기서 나아가 웹 인증서가 조작되거나 만료된 것은 아닌지 사용자에게 알려줌 <br/> &nbsp;&nbsp; → 이를 통해 사용자가 위험한 웹 사이트임을 인지할 수 있도록 함

<br/><br/>

## 기본 원리
### 서명과 검증
* 전자 서명의 과정
  <br/><br/>
  <img width="2560" alt="전자 서명 과정" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/f64bedf4-af2c-43a6-95de-4f021ce7e64c">
  <br/>
    | | 설명 |
    |:---:|------|
    | **서명 작성** <br/> (Signing) | 메시지를 서명키로 암호화하는 과정 <br/> &nbsp;&nbsp; - 서명키(Signing Key) = 서명자 본인만 알고 있어야 하는 비밀키 |
    | **서명 검증** <br/> (Vertification) | 서명을 검증키로 복호화하고 받은 메시지와 비교하는 과정 <br/> &nbsp;&nbsp; - 서명키(Vertification Key) = 모두에게 공개된 키 |
    - 전자 서명은 RSA(공개키 암호)의 과정을 정확히 반대로 수행함
        | 종류 | 과정 비교 |
        |:---:|------|
        | 공개키 암호(RSA) | 송신자가 수신자의 공개키로 암호화해서 전송하고, 수신자가 이를 수신자의 개인키로 복호화함 |
        | 전자 서명 | 송신자가 송신자의 개인키로 암호화해서 전송하고, 수신자가 이를 송신자의 공개키로 복호화함 |
* 서명자의 개인키로 서명했을 때만 검증을 통과할 수 있음 → 서명이 올바르다면 메시지는 서명자로부터 왔음이 증명됨
    - 전자 서명의 효과
        + 메시지의 무결성을 증명할 수 있음
        + 서명자는 자신이 메시지를 보냈음을 부인할 수 없음

<br/>

### 해시 함수를 이용한 전자 서명
| | 설명 |
|:---:|------|
| 사용 배경 | 전자 서명은 공개키 암호를 사용하기 때문에 서명하는 메시지의 크기가 $N(modulus)$보다 작아야 함 <br/> &nbsp;&nbsp; ⇒ 메시지의 크기가 $N$보다 크면 메시지를 나누어 서명해야 하는 불편함을 해소하고, 데이터의 크기와 상관없이 한 번에 서명하기 위해 <br/> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 일반적으로 해시 함수를 같이 사용함 |
| 과정 | 해시 함수로 메시지의 해시 값 $h(m)$을 생성하고, 이 값에 대한 서명을 생성함 <br/> &nbsp;&nbsp; - 이 과정을 수식으로 표현한 것 <br/> $$s = Sig_{sk}(h(m))$$  $$Ver_{pk}(h(m), s)$$ $$(h: 임의의 암호학적 해시 함수)$$|
| 기대 효과 | 전자 서명에서 해시 함수를 이용할 경우 효율성뿐만 아니라 안전성 향상에도 도움이 됨 |

<br/><br/>

## RSA 전자 서명
* RSA 공개키 암호를 사용하여 서명과 검증이 이루어짐
    - RSA 공개키 암호의 공개키는 검증키로 사용되고, 개인키는 서명키로 사용됨
        | 키 | 공개키 암호의 사용 목적 | 전자 서명의 사용 목적 |
        |:---:|------|------|
        | $(n ,e)$ | 사용자의 공개키 | 검증키 |
        | $d$ | 사용자의 개인키 | 서명키 |
    - RSA 전자 서명의 안전성은 **인수분해 문제의 어려움**에 기반하고 있음
    - RSA 서명 생성 및 검증 과정
      <br/><br/>
      <img width="2560" alt="RSA 전자 서명 과정" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/546ad4eb-4014-4a60-b65c-dba489d46948"><br/>

<br/>

### RSA 전자 서명 공격
<img width="2560" alt="RSA 전자 서명 공격" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/57cfd3ce-f40f-491a-95c3-629c6652b2c0"><br/>

<br/>

### 해시를 이용한 RSA 전자 서명
* 해시를 이용하면 위의 2가지 전자 서명 공격으로부터 **안전한 전자 서명**을 설계할 수 있음
    | 해시를 이용한 RSA 전자 서명에 위의 공격들을 수행하기 위한 조건 |
    |---|
    | $h(m) = s^e (mod$ $n)$ 또는 $h(m) = h(m_1)h(m_2)$를 만족하는 $m$를 구할 수 있어야 함 <br/> → 해시 함수의 역상 저항성(Preimage Resistance)으로 인해 매우 어려움 |

<br/><br/>

## ElGamal 전자 서명
* **이산 대수 문제의 어려움**에 기반하여 설계됨
    - 1984년 Taher Elgamal에 의해서 발표되었음 → 이를 모태로 하여 DSA(Digital Signature Algorithm) 전자 서명 등 다양한 전자 서명이 설계되었음
    - RSA 전자 서명의 취약점들을 해시를 이용해 보완한 것처럼 **ElGamal 전자 서명 과정에서도 해시를 사용함**

### ElGamal 키 생성
| 순서 | 설명 |
|:---:|------|
| 01 | 큰 소수 $p$와 키를 만드는 생성원 $g$를 선택함 |
| 02 | $p-1$보다 작고 $1$보다 큰 정수 $x$를 임의로 선택함 → $x$ = ElGamal의 서명키 |
| 03 | $y = g^x $ $(mod$ $p)$을 계산함 → $(y, g, p)$ = ElGamal의 검증 키|

<br/>

### ElGamal 서명 생성 및 서명 검증 과정
<img width="2560" alt="ElGamal 전자 서명 과정" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/fb437747-6fc8-4aca-9e80-ebe6eaadc207"><br/>


<br/>

### ElGamal 전자 서명 공격
* ElGamal 전자 서명의 **비결정적**(Nondeterministic) 성질
    - ElGamal 전자 서명은 서명 생성 과정에서 매번 서명을 할 때마다 새로운 난수 $k$를 선택하여 사용함 → *동일한 메시지에 대해서도 서명 값이 항상 변함*
    - RSA 서명 기법에 존재하던 문제점이 ElGamal에서는 대부분 해결됨
* ⚠️ 난수 $k$를 매번 같은 값으로 고정하면 서명키 $x$가 노출될 수 있다고 알려져 있음
    - 공격 방법
      <br/><br/>
      <img width="2560" alt="ElGamal 전자 서명 공격" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/c7d5f0db-8cf0-43af-8339-589adb76c670">
      <br/><br/>
    - 서명키 $x$를 알면 원하는 메시지의 서명값 또한 구할 수 있음 → **매우 위험한 취약점!** <br/> &nbsp;&nbsp; ⇒ 📌 $k$ 값은 고정된 값이 아닌 적절한 난수값으로 정해야 함

<br/><br/>

## DSA 전자 서명
* 1991년 NIST에 의해서 제안되었으며, 1994년 12월에 미국의 전자 서명 기법 표준으로 제정됨
    - 다른 서명과의 비교
        + DSA 전자 서명은 상대적으로 훨씬 짧은 서명 길이를 가지고 있음
            | 사용하는 소수 $p$의 크기 | ElGamal 서명의 길이 | DSA 서명의 길이 |
            |:---:|:---:|:---|
            | 1024비트 | 2048비트 | 320비트 |
        + 성능 면에서도 RSA 전자 서명보다 빠르다고 알려져 있음

<br/>

### DSA 키 생성
| 순서 | 설명 |
|:---:|------|
| 01 | 큰 소수 $p$와 $p-1$의 약수이면서 소수인 $q$를 선택함 |
| 02 | $p-1$보다 작고 $1$보다 큰 정수 $h$를 선택하고 생성원 $g ≡ h^{(p-1)/q}$ $(mod$ $p)$를 계산함 <br/> &nbsp;&nbsp; (만약 계산한 생성원 $g$가 $1$이 되면, $h$를 다시 선택하여 $1$이 아닌 $g$를 구함) |
| 03 | $1$ ~ $q-1$ 범위의 큰 정수 $x$를 임의로 선택함 → $x$ = DSA의 서명키 |
| 04 | $y = g^x$ $(mod$ $p)$를 계산함 → $(y, g, p ,q)$ = DSA의 검증키 |
| 05 | 안전한 해시 함수 $h$를 선택함 |

<br/>

### DSA 서명 생성 및 서명 검증 과정
<img width="2560" alt="DSA 전자 서명 과정" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/fab39aab-d91a-465a-8cee-64d33a6c743a">
<img width="2560" alt="DSA 전자 서명 검증-증명" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/04229ef9-4421-4ef9-90d4-2f245ba407eb"><br/>



<br/><br/><br/><br/>
### 🔖 출처
* [드림핵 Cryptography] 📌 [전자 서명](https://dreamhack.io/lecture/courses/78)

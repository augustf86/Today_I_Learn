# [Dreamhack Wargame] File Vulnerability Advanced for linux
### [π©File Vulnerability Advanced for linux](https://dreamhack.io/wargame/challenges/417/)
  <img width="1070" alt="FVA for linux_description" src="https://github.com/augustf86/Today_I_Learn/assets/122844932/10eeb994-29a0-4ed4-a571-4b3e3aa4c57a">

<br/><br/>

## λ¬Έμ  νμΌ(main.py) λ¶„μ„
```python
import os, subprocess
from functools import wraps
from flask import Flask, request

app = Flask(__name__)
API_KEY = os.environ.get('API_KEY', None) # ν™κ²½ λ³€μμ— μ„¤μ •λμ–΄ μλ” API_KEY κ°’μ„ κ°€μ Έμ΄

# key_required (λ°μ½”λ μ΄ν„°) ν•¨μ: API_KEYλ¥Ό κ²€μ‚¬ν•¨
def key_required(view):
    @wraps(view)
    def wrapped_view(**kwargs):
        apikey = request.args.get('API_KEY', None) # GET λ©”μ†λ“λ΅ μ „λ‹¬ν• API_KEY νλΌλ―Έν„°μ κ°’μ„ κ°€μ Έμ΄
        if API_KEY and apikey:
            if apikey == API_KEY: # API_KEY νλΌλ―Έν„°μ κ°’(apikey)μ΄ ν™κ²½ λ³€μμ— μ„¤μ •λμ–΄ μλ” API_KEYμ™€ λ™μΌν•μ§€ ν™•μΈν•¨
                return view(**kwargs)
        return 'Access Denined !'
    return wrapped_view


# index(/) νμ΄μ§€
@app.route('/', methods=['GET'])
def index():
    return 'API Index'


# file νμ΄μ§€
@app.route('/file', methods=['GET'])
def file():
    path = request.args.get('path', None) # μ΄μ©μκ°€ GET λ©”μ†λ“λ΅ μ „λ‹¬ν• path νλΌλ―Έν„°μ κ°’μ„ κ°€μ Έμ΄
    if path: # path νλΌλ―Έν„°μ κ°’μ΄ μ΅΄μ¬ν•λ” κ²½μ°
        data = open('./files/' + path).read() # path νλΌλ―Έν„°λ¥Ό ν†µν•΄ ./files/ κ²½λ΅λ΅λ¶€ν„° νμΌμ„ μ½μ (μ·¨μ•½μ μ΄ μ΅΄μ¬ν•λ” λ¶€λ¶„)
        return data # μ½μ–΄μ¨ νμΌ λ°μ΄ν„°λ¥Ό λ°ν™ν•¨
    return 'Error !'


# admin νμ΄μ§€
@app.route('/admin', methods=['GET'])
@key_required # key_required λ°μ½”λ μ΄ν„°λ΅ μΈν•΄ API_KEYλ¥Ό μ•κ³  μλ” μ΄μ©μλ§μ΄ μ‚¬μ©ν•  μ μμ
def admin():
    cmd = request.args.get('cmd', None) # GET λ©”μ†λ“λ΅ μ „λ‹¬λ cmd νλΌλ―Έν„°μ κ°’μ„ κ°€μ Έμ΄
    if cmd: # cmd νλΌλ―Έν„°μ κ°’μ΄ μ΅΄μ¬ν•λ” κ²½μ°
        result = subprocess.getoutput(cmd) # cmd νλΌλ―Έν„°λ¥Ό ν†µν•΄ μ‹μ¤ν… λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•¨
        return result # λ…λ Ήμ–΄ μ‹¤ν—Ή κ²°κ³Όλ¥Ό λ°ν™ν•¨
    else:
        return 'Error !'


if __name__ == '__main__':
    app.run(host='0.0.0.0')
```
* μ½”λ“ μ΄ν•΄λ¥Ό μ„ν• Python κ°λ…λ“¤
    - **Decorator(λ°μ½”λ μ΄ν„°)**: ν•¨μλ¥Ό μμ •ν•μ§€ μ•μ€ μƒνƒμ—μ„ μ¶”κ°€ κΈ°λ¥μ„ κµ¬ν„ν•  λ• μ‚¬μ©ν•¨
        + ```@```λ΅ μ‹μ‘ν•λ©°, νΈμ¶ν•  ν•¨μ μ„μ— ```@decorator``` ν•μ‹μΌλ΅ μ§€μ •ν•¨
            ```python
            @decorator
            def function_name():
                # code line
            ```
        + μ°Έκ³  μλ£: π“ [νμ΄μ¬ μ½”λ”© λ„μ¥: 42.1 λ°μ½”λ μ΄ν„° λ§λ“¤κΈ°](https://dojang.io/mod/page/view.php?id=2427)
    - **```subprocess``` λ¨λ“**: μƒλ΅μ΄ ν”„λ΅μ„Έμ¤λ¥Ό μƒμ„±ν• ν›„ μ…λ ¥/μ¶λ ¥/μ—λ¬ νμ΄ν”„μ— μ—°κ²°ν•κ³  λ°ν™ μ½”λ“λ¥Ό μ–»μ„ μ μλ„λ΅ ν•¨
        + ```os.system```, ```os.spawn*```λ¥Ό λ€μ²΄
        + subprocess.getoutput ν•¨μ
            | ν•μ‹ | μ„¤λ… |
            |-----|-----|
            | ```subprocess.getoutput(cmd, *, encoding=None, errors=None)``` | μ…Έμ—μ„ cmdλ¥Ό μ‹¤ν–‰ν• ν›„ μ¶λ ¥(stdoutκ³Ό stderr)λ¥Ό λ°ν™ν•¨ |
        + μ°Έκ³  μλ£: π“ [subprocess λ¨λ“](https://docs.python.org/ko/3/library/subprocess.html)


<br/><br/>

## λ¬Έμ  ν’€μ΄
